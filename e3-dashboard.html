<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Learner Dashboard</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
      }
      #dashboard-container {
        width: 100%;
        height: 100vh;
        box-sizing: border-box;
      }
      #dashboard-frame {
        width: 100%;
        height: 100%;
        border: 0;
      }
      #message {
        padding: 20px;
        font-size: 18px;
      }
    </style>
  </head>
  <body>

    <div id="dashboard-container">
      <div id="message">Loading your personalized dashboardâ€¦</div>
    </div>

    <script>
      (function () {
        // 1) Get learner email from URL: ?email=learner@example.com
        const params = new URLSearchParams(window.location.search);
        const email = params.get("email");

        if (!email) {
          document.getElementById("message").innerText =
            "Error: No learner email provided.";
          return;
        }

        // 2) Build ZOHO_CRITERIA string
        const criteria = `"Survey Responses"."Contact Email"='${email}'`;

        // 3) URL-encode the criteria for use in the Zoho URL
        const encodedCriteria = encodeURIComponent(criteria);

        // 4) Build the final Zoho dashboard URL
        const zohoUrl =
          "https://analytics.zoho.com/open-view/2603906000004171130" +
          "?ZOHO_CRITERIA=" +
          encodedCriteria;

        // 5) Create the iframe for Zoho Analytics
        const iframe = document.createElement("iframe");
        iframe.id = "dashboard-frame";
        iframe.src = zohoUrl;
        iframe.setAttribute("frameborder", "0");
        iframe.setAttribute("allowfullscreen", "true");

        // 6) Insert the iframe into the page
        const container = document.getElementById("dashboard-container");
        container.innerHTML = "";
        container.appendChild(iframe);
      })();
    </script>

  </body>
</html>
